#!/bin/zsh

# update_unused_wordle_answers.dev
# Updates file unused_wordle_answers.txt by removing current answer from list

print "\$ANSWER is $ANSWER"

# Add ANSWER to past_wordle_answers.txt
lines=$(wc -l < past_wordle_answers.txt)
print "past_wordle_answers.txt contains $lines answers"
print "Adding $NEW_ANSWER to past_wordle_answers.txt"
echo $NEW_ANSWER >> past_wordle_answers.txt

# Sort past_wordle_answers.txt alphabetically
sort past_wordle_answers.txt > past_wordle_answers.tmp
cp past_wordle_answers.tmp past_wordle_answers.txt

# Display new count of past_wordle_answers.txt
lines=$(wc -l < past_wordle_answers.txt)
print "past_wordle_answers.txt now contains $lines answers"

#Back up list of past wordle answers
mv past_wordle_answers.tmp past_wordle_answers.txt.bak

# Remove corrected_unused_wordle_answers.txt if exists
if [[ -e corrected_unused_wordle_answers.txt ]]
then
  if [[ "$VERBOSITY" -eq 2 ]]; then
    print "corrected_unused_wordle_answers.text exists ... deleting"
  fi
  rm corrected_unused_wordle_answers.txt
  print "Done"
fi
touch corrected_unused_wordle_answers.txt

lines=$(wc -l < unused_wordle_answers.txt)
if [[ "$VERBOSITY" -ge 1 ]]; then
  print "unused_wordle_answers.txt contains $lines lines"
  print "Deleting $ANSWER from unused_wordle_answers.txt"
fi

grep -v "$ANSWER" unused_wordle_answers.txt > corrected_unused_wordle_answers.txt

# Check for grep errors
  if [[ $? -ge "2" ]]
  then
    print -n "Error in grep - Exiting."
    exit 1
  fi

lines=$(wc -l < corrected_unused_wordle_answers.txt)

if [[ "$VERBOSITY" -ge 1 ]]; then
  print "corrected_unused_wordle_answers.txt now contains $lines lines"
fi

print "Updating unused_wordle_answers.txt ..."

cat corrected_unused_wordle_answers.txt > unused_wordle_answers.txt

lines=$(wc -l < unused_wordle_answers.txt)
if [[ "$VERBOSITY" -ge 1 ]]; then
  print "unused_wordle_answers.txt now contains $lines lines"
fi

print "... Done."

if [[ "$VERBOSITY" -ge 1 ]]; then
  print "Returning execution to wordle_solver.master.dev"
fi

return

return
